<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SyncVeil - Secure Interface</title>
  <style>
    /* --- CSS Variables & Reset --- */
    :root {
      --bg-color: #050505;
      --glass-bg: rgba(20, 30, 48, 0.4);
      --glass-border: rgba(255, 255, 255, 0.1);
      --primary-grad: linear-gradient(135deg, #004e92 0%, #000428 100%);
      --accent-grad: linear-gradient(90deg, #00c6ff, #0072ff);
      --text-main: #ffffff;
      --text-muted: rgba(255, 255, 255, 0.6);
      --neon-glow: 0 0 15px rgba(0, 114, 255, 0.5);
      --footer-bg: #000000;
      --success: #00ff88;
      --danger: #ff4b4b;
      --warning: #ffcc00;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-main);
      min-height: 100vh;
      width: 100vw;
      overflow-x: hidden;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    /* --- Animated Liquid Background --- */
    .liquid-bg {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      overflow: hidden;
      z-index: -1;
    }

    .blob {
      position: absolute;
      border-radius: 50%;
      filter: blur(60px);
      opacity: 0.6;
      animation: float 10s infinite ease-in-out;
    }

    .blob-1 { top: -10%; left: -10%; width: 50vw; height: 50vw; background: radial-gradient(circle, #000428, #004e92); animation-delay: 0s; }
    .blob-2 { bottom: -10%; right: -10%; width: 60vw; height: 60vw; background: radial-gradient(circle, #004e92, #00c6ff); animation-delay: -5s; }
    .blob-3 { top: 40%; left: 40%; width: 30vw; height: 30vw; background: rgba(0, 198, 255, 0.3); animation: pulse 8s infinite alternate; }

    @keyframes float {
      0% { transform: translate(0, 0) rotate(0deg); }
      33% { transform: translate(30px, -50px) rotate(10deg); }
      66% { transform: translate(-20px, 20px) rotate(-5deg); }
      100% { transform: translate(0, 0) rotate(0deg); }
    }
    @keyframes pulse { 0% { transform: scale(1); opacity: 0.4; } 100% { transform: scale(1.2); opacity: 0.7; } }

    /* --- Header --- */
    .site-header {
      padding: 20px 40px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      z-index: 10;
      -webkit-backdrop-filter: blur(5px);
      backdrop-filter: blur(5px);
      position: sticky;
      top: 0;
      background: rgba(5, 5, 5, 0.5);
    }

    .logo-wrap { display: flex; align-items: center; gap: 15px; cursor: pointer; }
    .logo-icon { font-size: 2rem; color: #00c6ff; filter: drop-shadow(0 0 5px #0072ff); }
    .logo-text { font-size: 1.5rem; font-weight: 700; letter-spacing: 1px; background: var(--accent-grad); -webkit-background-clip: text; background-clip: text; color: transparent; text-transform: uppercase; }

    /* --- Main Container & Glass Card --- */
    .main-container {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      padding: 40px 20px;
      position: relative;
      min-height: 80vh;
    }

    .glass-card {
      width: 450px;
      max-width: 100%;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      padding: 40px;
      -webkit-backdrop-filter: blur(20px);
      backdrop-filter: blur(20px);
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5), inset 0 0 0 1px rgba(255, 255, 255, 0.05);
      transform-style: preserve-3d;
      animation: cardEntrance 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
    }

    .glass-card.wide { width: 800px; text-align: left; }

    /* Dashboard Layout */
    .dashboard-view { width: 100%; max-width: 1100px; align-self: center; }
    .dashboard-header-card { display: flex; flex-direction: column; align-items: center; margin-bottom: 30px; padding: 30px; }
    .dash-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; width: 100%; }
    .dash-card { width: 100% !important; height: 100%; padding: 25px; display: flex; flex-direction: column; }

    @keyframes cardEntrance { from { opacity: 0; transform: translateY(30px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }

    h2 { margin-bottom: 10px; font-size: 2rem; font-weight: 600; }
    h3 { font-size: 1.2rem; margin-top: 0; margin-bottom: 15px; color: #00c6ff; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
    p { color: var(--text-muted); margin-bottom: 30px; line-height: 1.6; }

    /* --- Dashboard Specific Styles --- */
    .profile-avatar-large {
        font-size: 4rem; color: #fff; background: rgba(255,255,255,0.1); width: 100px; height: 100px;
        border-radius: 50%; display: flex; align-items: center; justify-content: center;
        margin-bottom: 15px; box-shadow: 0 0 20px rgba(0, 198, 255, 0.3);
    }
    .stat-number { font-size: 3rem; font-weight: 700; color: #fff; margin-bottom: 5px; }
    
    .history-list { list-style: none; padding: 0; margin: 0; font-size: 0.9rem; max-height: 200px; overflow-y: auto; }
    .history-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05); color: var(--text-muted); }
    .history-item span.device { color: #fff; }

    .scan-console {
      background: rgba(0,0,0,0.5); border-radius: 8px; padding: 15px; font-family: monospace; font-size: 0.85rem;
      color: #00ff88; height: 150px; overflow-y: auto; margin-top: 15px; display: none; border: 1px solid #333;
    }
    .scan-result-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dashed rgba(255,255,255,0.1); }
    .leaked-source { color: var(--danger); font-weight: bold; }

    /* --- Utility Classes --- */
    .flex-row { display: flex; gap: 10px; }
    .flex-1 { flex: 1; }
    .dashboard-full-width { width: 100%; }
    .btn-margin { margin-top: 10px; }
    .icon-space { margin-right: 8px; }
    .section-divider { text-align: center; margin: 20px 0; }
    .section-divider-lg { margin: 40px 0; }
    .section-subtext { margin: 0; }
    .otp-input-style { letter-spacing: 5px; text-align: center; font-size: 1.2rem; }
    .plane-icon { font-size: 3rem; color: #00c6ff; }
    .verify-text { margin-top: 20px; font-size: 0.9rem; }
    .no-margin { margin-bottom: 0; }
    .logo-compact { padding: 0; margin-bottom: 15px; }
    .flex-between { display: flex; gap: 10px; align-items: center; }
    .grid-full { grid-column: 1 / -1; }

    /* --- Forms & Inputs --- */
    .form-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 8px; color: var(--text-muted); font-size: 0.9rem; font-weight: 500; }
    input, select, textarea {
      width: 100%; padding: 12px 16px; border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.1); background: rgba(0, 0, 0, 0.2);
      color: #fff; font-size: 1rem; transition: all 0.3s ease; outline: none;
    }
    input:focus, select:focus, textarea:focus { border-color: #00c6ff; background: rgba(0, 0, 0, 0.4); box-shadow: 0 0 15px rgba(0, 198, 255, 0.1); }
    textarea { resize: vertical; min-height: 80px; }

    /* --- Buttons & Options --- */
    .btn-group { display: flex; gap: 15px; margin-top: 30px; }
    .btn-group.center { justify-content: center; }
    .btn {
      flex: 1; padding: 14px; border-radius: 10px; border: none; font-size: 1rem; font-weight: 600;
      cursor: pointer; transition: all 0.3s ease; text-align: center; text-decoration: none;
      display: inline-flex; justify-content: center; align-items: center;
    }
    .btn-sm { padding: 8px 16px; font-size: 0.85rem; flex: initial; }
    .btn-primary { background: var(--accent-grad); color: #fff; box-shadow: 0 4px 15px rgba(0, 114, 255, 0.3); }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 114, 255, 0.5); }
    .btn-ghost { background: transparent; border: 1px solid rgba(255, 255, 255, 0.2); color: var(--text-muted); }
    .btn-ghost:hover { border-color: #fff; color: #fff; background: rgba(255, 255, 255, 0.05); }

    .verify-option {
      border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px;
      margin-bottom: 15px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 15px;
    }
    .verify-option:hover { background: rgba(255,255,255,0.05); border-color: #00c6ff; }
    .verify-option i { font-size: 1.5rem; color: #00c6ff; }
    .verify-option h4 { margin: 0 0 5px 0; color: #fff; }
    .verify-option p { margin: 0; font-size: 0.85rem; color: var(--text-muted); }

    /* --- Views --- */
    .view-section { display: none; animation: fadeIn 0.5s ease; }
    .view-section.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .profile-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
    .profile-item:last-child { border-bottom: none; }
    .profile-label { color: var(--text-muted); text-transform: capitalize; }
    .profile-value { font-weight: 600; color: #fff; }
    .error-msg { color: #ff4b4b; font-size: 0.9rem; margin-top: 10px; text-align: center; }

    /* --- Footer --- */
    .site-footer { background-color: var(--footer-bg); border-top: 1px solid rgba(255, 255, 255, 0.1); padding: 60px 40px 20px; font-size: 0.9rem; margin-top: auto; position: relative; z-index: 2; }
    .footer-content { display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 40px; max-width: 1200px; margin: 0 auto; margin-bottom: 60px; }
    .footer-brand h3 { font-size: 1.5rem; margin-bottom: 10px; color: #fff; }
    .footer-brand p { color: var(--text-muted); font-size: 0.85rem; margin-bottom: 20px; }
    .social-icons { display: flex; gap: 15px; margin-bottom: 25px; }
    .social-icons a { color: #fff; font-size: 1.2rem; transition: color 0.3s; }
    .social-icons a:hover { color: #00c6ff; }
    .lang-selector { display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; border: 1px solid rgba(255, 255, 255, 0.3); color: #fff; text-decoration: none; font-weight: 600; transition: all 0.3s; cursor: pointer; }
    .lang-selector:hover { background: rgba(255, 255, 255, 0.1); border-color: #fff; }
    .footer-col h4 { color: #fff; margin-bottom: 20px; font-size: 1rem; }
    .footer-col ul { list-style: none; }
    .footer-col li { margin-bottom: 12px; }
    .footer-col a { color: var(--text-muted); text-decoration: none; transition: color 0.3s; font-size: 0.9rem; cursor: pointer; }
    .footer-col a:hover { color: #00c6ff; }
    .footer-bottom { border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 20px; text-align: center; color: var(--text-muted); font-size: 0.8rem; }
    .footer-bottom-links { display: flex; justify-content: center; flex-wrap: wrap; gap: 20px; }
    .footer-bottom-links a { color: var(--text-muted); text-decoration: none; cursor: pointer; }
    .footer-bottom-links a:hover { text-decoration: underline; }

    @media (max-width: 600px) {
      .glass-card { padding: 25px; } .site-header { padding: 15px 20px; }
      .footer-content { grid-template-columns: 1fr; text-align: center; }
      .social-icons { justify-content: center; } .dash-grid { grid-template-columns: 1fr; }
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

  <div class="liquid-bg">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>
  </div>

  <header class="site-header">
    <div class="logo-wrap" onclick="app.navigate('home')">
      <i class="fa-solid fa-shield-halved logo-icon"></i>
      <div class="logo-text">SyncVeil</div>
    </div>
  </header>

  <main class="main-container">
    
    <!-- VIEW: HOME / LOGIN -->
    <div id="view-home" class="view-section active glass-card">
      <h2>Welcome Back</h2>
      <p>Enter your encrypted credentials.</p>
      <form id="login-form">
        <div class="form-group">
          <label>Email Address</label>
          <input type="email" name="email" placeholder="user@example.com" required>
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" name="password" placeholder="••••••••" required>
        </div>
        <div id="login-msg" class="error-msg"></div>
        <div class="btn-group">
          <button type="submit" class="btn btn-primary">Login</button>
          <button type="button" class="btn btn-ghost" onclick="app.navigate('register')">Create New Account</button>
        </div>
      </form>
    </div>

    <!-- VIEW: REGISTER (STEP 1) -->
    <div id="view-register" class="view-section glass-card">
      <h2>Complete Profile</h2>
      <p>Fill in your details to begin.</p>
      <form id="register-form">
        <div class="form-group"><label>Full Name</label><input type="text" name="name" required></div>
        <div class="form-group"><label>Email</label><input type="email" name="email" required></div>
        <div class="form-group"><label>Mobile</label><input type="tel" name="mobile" required></div>
        <div class="flex-row">
          <div class="form-group flex-1"><label>Age</label><input type="number" name="age"></div>
          <div class="form-group flex-1"><label>Gender</label>
            <select name="gender"><option>Male</option><option>Female</option><option>Other</option></select>
          </div>
        </div>
        <div class="form-group"><label>Address</label><textarea name="address"></textarea></div>
        <div class="form-group"><label>Password</label><input type="password" name="password" required></div>
        <div class="btn-group">
          <button type="submit" class="btn btn-primary">Continue to Verification</button>
          <button type="button" class="btn btn-ghost" onclick="app.navigate('home')">Cancel</button>
        </div>
      </form>
    </div>

    <!-- VIEW: CHOOSE VERIFICATION (STEP 2) -->
    <div id="view-verify-method" class="view-section glass-card">
      <h2>Select Verification</h2>
      <p>How would you like to verify your identity?</p>
      
      <div class="verify-option" onclick="app.setVerifyMethod('email')">
        <i class="fa-solid fa-envelope"></i>
        <div>
          <h4>Email Verification</h4>
          <p>We'll send a secure link to your email.</p>
        </div>
      </div>

      <div class="verify-option" onclick="app.setVerifyMethod('sms')">
        <i class="fa-solid fa-mobile-screen"></i>
        <div>
          <h4>Mobile OTP</h4>
          <p>We'll send a 4-digit code to your phone.</p>
        </div>
      </div>

      <div class="btn-group">
        <button type="button" class="btn btn-ghost" onclick="app.navigate('register')">Back</button>
      </div>
    </div>

    <!-- VIEW: EMAIL LINK VERIFY (STEP 3A) -->
    <div id="view-verify-link" class="view-section glass-card">
      <h2>Check Your Email</h2>
      <p>We sent a verification link to <strong id="verify-email-display"></strong>.</p>
      <div class="section-divider section-divider-lg">
        <i class="fa-solid fa-paper-plane plane-icon"></i>
        <p class="verify-text">Click the link in the email to verify your account.</p>
      </div>
      <button class="btn btn-primary" onclick="app.simulateEmailClick()">[Simulation] Click Email Link</button>
      <div class="btn-group"><button type="button" class="btn btn-ghost" onclick="app.navigate('verify-method')">Try another method</button></div>
    </div>

    <!-- VIEW: SMS OTP VERIFY (STEP 3B) -->
    <div id="view-verify-otp" class="view-section glass-card">
      <h2>Enter OTP</h2>
      <p>Enter the code sent to <strong id="verify-mobile-display"></strong>.</p>
      <div class="form-group">
        <label>4-Digit Code</label>
        <input type="text" id="otp-input" placeholder="XXXX" class="otp-input-style">
      </div>
      <div id="otp-msg" class="error-msg"></div>
      <div class="btn-group">
        <button type="button" class="btn btn-primary" onclick="app.verifyOtp()">Verify & Register</button>
        <button type="button" class="btn btn-ghost" onclick="app.navigate('verify-method')">Back</button>
      </div>
    </div>

    <!-- VIEW: DASHBOARD -->
    <div id="view-dashboard" class="view-section dashboard-view">
        <div class="glass-card dashboard-header-card dashboard-full-width">
            <div class="profile-avatar-large"><i class="fa-solid fa-user"></i></div>
            <h2 id="dash-name">User Name</h2>
            <p id="dash-email">user@example.com</p>
            <div class="btn-group center btn-margin">
                <button class="btn btn-ghost btn-sm" onclick="app.logout()"><i class="fa-solid fa-right-from-bracket icon-space"></i> Logout</button>
            </div>
        </div>

        <div class="dash-grid">
            <!-- Personal Details -->
            <div class="glass-card dash-card">
                <h3><i class="fa-solid fa-id-card"></i> Personal Details</h3>
                <div id="profile-details-list"></div>
            </div>

            <!-- Password Vault -->
            <div class="glass-card dash-card">
                <h3><i class="fa-solid fa-key"></i> Saved Passwords</h3>
                <div class="section-divider">
                    <div class="stat-number">3</div>
                    <p class="no-margin">Encrypted Credentials</p>
                </div>
                <button class="btn btn-primary btn-sm">Open Vault</button>
            </div>

            <!-- Login History -->
            <div class="glass-card dash-card">
                <h3><i class="fa-solid fa-clock-rotate-left"></i> Login Activity</h3>
                <ul class="history-list" id="login-history-list">
                    <!-- Populated by JS -->
                </ul>
            </div>

             <!-- Breach Check -->
             <div class="glass-card dash-card grid-full">
                <h3><i class="fa-solid fa-user-shield"></i> Deep Web Breach Scanner</h3>
                <p>Scan dark web databases and hacker forums for your compromised data.</p>
                <div class="flex-between">
                    <button id="scan-btn" class="btn btn-primary" onclick="app.checkLeak()">Initiate Deep Scan</button>
                </div>
                <div id="scan-console" class="scan-console"></div>
            </div>
        </div>
    </div>

    <!-- Generic Page Views -->
    <div id="view-generic" class="view-section glass-card"><h2 id="generic-title"></h2><p id="generic-content"></p><button class="btn btn-primary" onclick="app.navigate('home')">Back</button></div>
    <div id="view-terms" class="view-section glass-card wide"><h2>Terms of Use</h2><p>Legal text here...</p><button class="btn btn-primary" onclick="app.navigate('home')">Back</button></div>
    <div id="view-privacy" class="view-section glass-card wide"><h2>Privacy Policy</h2><p>Privacy text here...</p><button class="btn btn-primary" onclick="app.navigate('home')">Back</button></div>

  </main>

  <footer class="site-footer">
    <div class="footer-content">
      <div class="footer-brand">
        <div class="logo-wrap logo-compact" onclick="app.navigate('home')"><i class="fa-solid fa-shield-halved logo-icon"></i><span class="logo-text">SyncVeil</span></div>
        <p>SyncVeil Corp | © SyncVeil, LLC</p>
        <div class="social-icons"><a href="#" title="YouTube"><i class="fa-brands fa-youtube"></i></a><a href="#" title="Twitter"><i class="fa-brands fa-twitter"></i></a><a href="#" title="Instagram"><i class="fa-brands fa-instagram"></i></a></div>
      </div>
      <div class="footer-col"><h4>Explore</h4><ul><li><a onclick="app.showGeneric('Features', 'AES-256 encryption...')">Secure Features</a></li></ul></div>
      <div class="footer-col"><h4>Resources</h4><ul><li><a onclick="app.showGeneric('Help', 'Contact support...')">Help Center</a></li></ul></div>
    </div>
    <div class="footer-bottom"><div class="footer-bottom-links"><a onclick="app.navigate('terms')">Terms</a><a onclick="app.navigate('privacy')">Privacy</a></div></div>
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBXX1KptKh0ziXVAmNVAWFzvApLY8RjF8k",
      authDomain: "syncveil.firebaseapp.com",
      projectId: "syncveil",
      storageBucket: "syncveil.firebasestorage.app",
      messagingSenderId: "808362857106",
      appId: "1:808362857106:web:7edf603fc0935641db4c4b",
      measurementId: "G-ZFFXYVQY6F"
    };

    let auth, db;
    try {
      const fbApp = initializeApp(firebaseConfig);
      auth = getAuth(fbApp);
      db = getFirestore(fbApp);
    } catch(e) { console.error("Firebase config error", e); }

    const app = {
      state: { currentUser: null, pendingUser: null, simulatedOtp: null },

      init() {
        if (!auth) return;
        onAuthStateChanged(auth, async (user) => {
          if (user) {
            try {
              const docRef = doc(db, "users", user.uid);
              const docSnap = await getDoc(docRef);
              if (docSnap.exists()) {
                this.state.currentUser = docSnap.data();
              } else {
                this.state.currentUser = { email: user.email, name: "User" };
              }
            } catch (error) { this.state.currentUser = { email: user.email, name: "User" }; }
            this.navigate('dashboard');
          } else {
            this.state.currentUser = null;
            this.navigate('home');
          }
        });
        this.setupListeners();
      },

      setupListeners() {
        document.getElementById('login-form').addEventListener('submit', e => { e.preventDefault(); this.handleLogin(new FormData(e.target)); });
        document.getElementById('register-form').addEventListener('submit', e => { e.preventDefault(); this.handleRegisterStep1(new FormData(e.target)); });
      },

      navigate(viewId) {
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        if (viewId === 'dashboard') this.renderDashboard();
        if (viewId === 'verify-link') document.getElementById('verify-email-display').innerText = this.state.pendingUser.email;
        if (viewId === 'verify-otp') document.getElementById('verify-mobile-display').innerText = this.state.pendingUser.mobile;
        
        const target = document.getElementById(`view-${viewId}`);
        if(target) target.classList.add('active');
        document.body.scrollTo({ top: 0, behavior: 'smooth' });
      },

      async handleLogin(formData) {
        const email = formData.get('email');
        const password = formData.get('password');
        const msg = document.getElementById('login-msg');
        msg.innerText = 'Authenticating...';
        try {
          const cred = await signInWithEmailAndPassword(auth, email, password);
          // Log Activity to Firestore
          const device = navigator.platform + " - " + navigator.vendor;
          const time = new Date().toLocaleString();
          const userRef = doc(db, "users", cred.user.uid);
          await updateDoc(userRef, {
            loginHistory: arrayUnion({ device, time, ip: "192.168.x.x (Simulated)" })
          }).catch(err => console.log("History update skipped (new user)"));
        } catch (error) {
          msg.innerText = "Login failed: " + error.code;
        }
      },

      handleRegisterStep1(formData) {
        this.state.pendingUser = Object.fromEntries(formData.entries());
        this.navigate('verify-method');
      },

      setVerifyMethod(method) {
        if(method === 'email') {
            this.navigate('verify-link');
        } else {
            // Simulate Sending SMS OTP
            this.state.simulatedOtp = Math.floor(1000 + Math.random() * 9000).toString();
            alert(`[SMS SIMULATION]\nFrom: SyncVeil Security\nCode: ${this.state.simulatedOtp}`);
            this.navigate('verify-otp');
        }
      },

      simulateEmailClick() {
          alert("Email Verified Successfully!");
          this.finalizeRegistration();
      },

      verifyOtp() {
          const input = document.getElementById('otp-input').value;
          if(input === this.state.simulatedOtp) {
              this.finalizeRegistration();
          } else {
              document.getElementById('otp-msg').innerText = "Incorrect Code.";
          }
      },

      async finalizeRegistration() {
        const { email, password, ...profileData } = this.state.pendingUser;
        try {
          const cred = await createUserWithEmailAndPassword(auth, email, password);
          const device = navigator.platform;
          const time = new Date().toLocaleString();
          
          await setDoc(doc(db, "users", cred.user.uid), {
            email, ...profileData,
            loginHistory: [{ device, time, ip: "Registration IP" }]
          });
          // Auth listener handles redirect
        } catch (error) { alert("Registration Error: " + error.message); }
      },

      renderDashboard() {
        const user = this.state.currentUser;
        if (!user) return;
        document.getElementById('dash-name').innerText = user.name || "User";
        document.getElementById('dash-email').innerText = user.email;

        // Details
        const container = document.getElementById('profile-details-list');
        const keys = ['name', 'email', 'mobile', 'age', 'gender', 'address'];
        container.innerHTML = keys.map(k => user[k] ? `<div class="profile-item"><span class="profile-label">${k}</span><span class="profile-value">${user[k]}</span></div>` : '').join('');

        // History
        const histContainer = document.getElementById('login-history-list');
        const history = user.loginHistory || [];
        histContainer.innerHTML = history.reverse().slice(0, 5).map(h => 
            `<li class="history-item"><span class="device"><i class="fa-solid fa-desktop"></i> ${h.device}</span><span>${h.time}</span></li>`
        ).join('');
      },

      checkLeak() {
          const consoleDiv = document.getElementById('scan-console');
          const btn = document.getElementById('scan-btn');
          consoleDiv.style.display = 'block';
          consoleDiv.innerHTML = '<div>Initializing connection to threat intelligence feeds...</div>';
          btn.disabled = true;
          
          const steps = [
              "Connecting to Tor relay node...",
              "Querying breach database: Collection #1...",
              "Querying breach database: RockYou2024...",
              "Analyzing pastebin dumps for " + this.state.currentUser.email + "...",
              "Cross-referencing mobile number hash..."
          ];

          let i = 0;
          const interval = setInterval(() => {
              if(i < steps.length) {
                  consoleDiv.innerHTML += `<div>> ${steps[i]}</div>`;
                  consoleDiv.scrollTop = consoleDiv.scrollHeight;
                  i++;
              } else {
                  clearInterval(interval);
                  this.showLeakResults(consoleDiv);
                  btn.disabled = false;
              }
          }, 800);
      },

      showLeakResults(div) {
          // Simulation logic: 30% chance of "finding" a leak
          const found = Math.random() > 0.7;
          div.innerHTML += '<div style="margin-top:10px; border-top:1px solid #555; padding-top:5px;">Scan Complete.</div>';
          
          if(found) {
              div.innerHTML += `
                <div class="scan-result-row">
                    <span class="leaked-source">CRITICAL: Adobe Breach (2013)</span>
                    <span>Email, Password Hint</span>
                </div>
                <div class="scan-result-row">
                    <span class="leaked-source">WARNING: LinkedIn Scrape (2021)</span>
                    <span>Public Profile, Email</span>
                </div>
                <div style="color:var(--danger); margin-top:10px;">ACTION REQUIRED: Change passwords immediately.</div>
              `;
          } else {
              div.innerHTML += '<div style="color:var(--success); font-weight:bold;">No leaked credentials found in known databases. Your digital footprint appears clean.</div>';
          }
          div.scrollTop = consoleDiv.scrollHeight;
      },

      async logout() { await signOut(auth); },
      showGeneric(title, content) { document.getElementById('generic-title').innerText = title; document.getElementById('generic-content').innerText = content; this.navigate('generic'); }
    };

    window.app = app;
    document.addEventListener('DOMContentLoaded', () => app.init());
  </script>
</body>
</html>